<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fluxgram | Ultimate Enterprise Messenger</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-base: #0e1621; --bg-surface: #17212b; --bg-hover: #202b36;
            --primary: #ff0050; --accent: #00f3ff; --text-main: #ffffff;
            --text-muted: #7f91a4; --divider: #101921; --msg-rx: #182533;
            --msg-tx: #ff0050; --transition: 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100vw; height: 100dvh; background: var(--bg-base); color: var(--text-main); font-family: 'Roboto', sans-serif; overflow: hidden; position: fixed; inset: 0; }
        
        #app-root { display: flex; width: 100%; height: 100%; position: relative; overflow: hidden; }
        .view-layer { position: absolute; inset: 0; background: var(--bg-base); z-index: 50; transform: translateX(100%); transition: transform var(--transition); display: flex; flex-direction: column; overflow: hidden; }
        .view-layer.active { transform: translateX(0); }
        .base-layer { position: relative; z-index: 10; width: 100%; height: 100%; display: flex; overflow: hidden; }

        /* --- AUTH SCREEN --- */
        #auth-screen { position: absolute; inset: 0; background: radial-gradient(circle at top left, #15050a 0%, var(--bg-base) 100%); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; transition: 0.5s; }
        .auth-card { background: var(--bg-surface); padding: 40px; border-radius: 24px; width: 100%; max-width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid var(--divider); }
        .auth-logo { font-size: 4rem; margin-bottom: 20px; font-family: 'Outfit'; text-align: center; }
        .auth-logo i { color: var(--primary); text-shadow: 0 0 20px var(--primary); }
        .input-group { margin-bottom: 20px; }
        .auth-input { width: 100%; background: var(--bg-base); border: 1px solid var(--divider); padding: 18px; border-radius: 12px; color: white; font-size: 1.1rem; outline: none; transition: 0.3s; }
        .auth-input:focus { border-color: var(--accent); }
        .auth-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, var(--primary), #cc0040); border: none; border-radius: 12px; color: white; font-size: 1.2rem; font-weight: 700; cursor: pointer; box-shadow: 0 10px 20px rgba(255,0,80,0.3); }

        /* --- SIDEBAR & CHAT LIST --- */
        .sidebar { width: 380px; height: 100%; background: var(--bg-surface); border-right: 1px solid var(--divider); display: flex; flex-direction: column; z-index: 20; flex-shrink: 0; transition: var(--transition); }
        .sb-header { padding: 15px 20px; display: flex; align-items: center; gap: 15px; }
        .search-box { flex: 1; background: var(--bg-base); border-radius: 20px; display: flex; align-items: center; padding: 0 15px; height: 42px; }
        .search-input { background: transparent; border: none; color: white; width: 100%; outline: none; margin-left: 10px; }
        
        .chat-list { flex: 1; overflow-y: auto; background: var(--bg-base); }
        .chat-cell { display: flex; align-items: center; padding: 15px 20px; cursor: pointer; border-bottom: 1px solid var(--divider); transition: 0.2s; }
        .chat-cell:hover { background: var(--bg-hover); }
        .chat-cell.active { background: #2b5278; }
        .c-avatar { width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: 800; margin-right: 15px; flex-shrink: 0; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .verified { color: #00f3ff; font-size: 0.85rem; margin-left: 5px; }

        /* --- CHAT AREA --- */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: url('https://web.telegram.org/a/chat-bg-pattern-dark.png'), var(--bg-base); position: relative; height: 100%; }
        .chat-top-bar { height: 65px; background: var(--bg-surface); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid var(--divider); z-index: 10; }
        .msg-scroll { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        
        .bubble-wrap { display: flex; flex-direction: column; max-width: 75%; }
        .wrap-rx { align-self: flex-start; }
        .wrap-tx { align-self: flex-end; }
        .bubble { padding: 12px 16px; border-radius: 18px; font-size: 1rem; line-height: 1.5; position: relative; word-wrap: break-word; }
        .bubble-rx { background: var(--msg-rx); border-bottom-left-radius: 4px; border: 1px solid var(--divider); }
        .bubble-tx { background: linear-gradient(135deg, var(--primary), #99002e); border-bottom-right-radius: 4px; box-shadow: 0 4px 15px rgba(255,0,80,0.15); }

        /* --- CALL SCREEN (NEW) --- */
        #call-view { position: absolute; inset: 0; background: linear-gradient(180deg, #1a1a2e 0%, #0a0a0c 100%); z-index: 500; display: none; flex-direction: column; align-items: center; justify-content: space-between; padding: 100px 20px; }
        .call-avatar { width: 150px; height: 150px; border-radius: 50%; border: 5px solid var(--accent); box-shadow: 0 0 30px var(--accent); animation: pulse 2s infinite; }
        .call-name { font-size: 2rem; font-weight: 700; margin-top: 20px; }
        .call-status { color: var(--accent); letter-spacing: 2px; }
        .call-actions { display: flex; gap: 40px; margin-bottom: 50px; }
        .call-btn { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; cursor: pointer; transition: 0.3s; }
        .btn-end { background: #ff3b30; }
        .btn-accept { background: #4cd964; }

        /* --- SETTINGS & POLICY --- */
        .doc-content { padding: 30px; line-height: 1.8; color: #ddd; overflow-y: auto; height: calc(100% - 60px); }
        .doc-content h2 { color: var(--accent); margin: 25px 0 10px; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        @media (max-width: 768px) {
            .sidebar { width: 100%; position: absolute; }
            .chat-area { position: absolute; width: 100%; z-index: 30; transform: translateX(100%); transition: var(--transition); }
            .chat-area.active { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <div id="app-root">
        <div id="auth-screen">
            <div class="auth-logo"><i class="fas fa-bolt"></i> <span>Flux<b>gram</b></span></div>
            <div class="auth-card">
                <div class="input-group">
                    <input type="text" class="auth-input" id="authName" placeholder="Full Name">
                </div>
                <div class="input-group">
                    <input type="tel" class="auth-input" id="authPhone" placeholder="+8801XXXXXXXXX">
                </div>
                <button class="auth-btn" onclick="executeLogin()">Access Secure Server</button>
            </div>
        </div>

        <div class="base-layer">
            <div class="sidebar">
                <div class="sb-header">
                    <i class="fas fa-bars" onclick="toggleDrawer()" style="cursor:pointer; font-size:1.4rem;"></i>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" class="search-input" placeholder="Search">
                    </div>
                </div>
                <div class="chat-list" id="chatList">
                    </div>
            </div>

            <div class="chat-area" id="chatArea">
                <div id="activeChat" style="display:none; height:100%; flex-direction:column;">
                    <div class="chat-top-bar">
                        <div style="display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="navTo('view-profile')">
                            <i class="fas fa-arrow-left" onclick="backToList(event)" style="margin-right:10px;"></i>
                            <div id="activeAvatar" class="c-avatar" style="width:40px; height:40px; font-size:1rem;"></div>
                            <div>
                                <div id="activeName" style="font-weight:600;">Name</div>
                                <div style="font-size:0.8rem; color:var(--accent);">online</div>
                            </div>
                        </div>
                        <div style="display:flex; gap:20px; color:var(--text-muted);">
                            <i class="fas fa-phone-alt" onclick="startCall()" style="cursor:pointer;"></i>
                            <i class="fas fa-ellipsis-v"></i>
                        </div>
                    </div>
                    <div class="msg-scroll" id="msgScroll"></div>
                    <div class="input-bar">
                        <i class="fas fa-paperclip" style="font-size:1.5rem; color:var(--text-muted); cursor:pointer;"></i>
                        <div style="flex:1; background:var(--bg-base); border-radius:20px; padding:10px 15px;">
                            <textarea id="msgInput" rows="1" placeholder="Message" style="width:100%; background:transparent; border:none; color:white; outline:none; font-size:1rem;"></textarea>
                        </div>
                        <button onclick="sendMessage()" style="width:45px; height:45px; border-radius:50%; background:var(--primary); color:white; border:none; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div id="call-view">
            <div class="call-avatar" id="callAvatar">K</div>
            <h1 class="call-name" id="callName">KAWCHUR</h1>
            <p class="call-status">FLUX SECURE CALL...</p>
            <div class="call-actions">
                <div class="call-btn btn-end" onclick="endCall()"><i class="fas fa-phone-slash"></i></div>
                <div class="call-btn btn-accept" onclick="alert('Connected via PeerJS (Simulation)')"><i class="fas fa-phone"></i></div>
            </div>
        </div>

        <div class="view-layer" id="view-settings">
            <div class="app-header">
                <i class="fas fa-arrow-left btn-icon" onclick="navBack()"></i>
                <div class="header-title">Settings</div>
            </div>
            <div class="doc-content">
                <div style="text-align:center; padding-bottom:30px;">
                    <div class="c-avatar" style="width:100px; height:100px; font-size:3rem; margin: 0 auto 15px; background:var(--primary)">U</div>
                    <h2 id="setProfileName">User</h2>
                    <p style="color:var(--accent)">@username</p>
                </div>
                <div style="background:var(--bg-surface); border-radius:12px; padding:10px;">
                    <div style="padding:15px; border-bottom:1px solid var(--divider);" onclick="navTo('view-policy')">Privacy & Policy</div>
                    <div style="padding:15px; border-bottom:1px solid var(--divider);">Notification Settings</div>
                    <div style="padding:15px;">Data & Storage</div>
                </div>
            </div>
        </div>

        <div class="view-layer" id="view-policy">
            <div class="app-header">
                <i class="fas fa-arrow-left btn-icon" onclick="navBack()"></i>
                <div class="header-title">Privacy Policy</div>
            </div>
            <div class="doc-content">
                <h1>Fluxgram Legal Agreement</h1>
                <p>Fluxgram is an enterprise-grade messenger built by <b>KAWCHUR</b>. Your privacy is our absolute priority.</p>
                <h2>1. Encryption Protocols</h2>
                <p>We use Flux Matrix Protocols for end-to-end encryption. No one, including Fluxgram engineers, can read your private chats.</p>
                <h2>2. Data Collection</h2>
                <p>We do not collect personal identifiers for advertisement. Your phone number is strictly used for authentication via Google Firebase.</p>
                <h2>3. Self-Destruct</h2>
                <p>Account data is purged after 6 months of inactivity to ensure a clean digital footprint.</p>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCsbZ1fqDivv8OyUiTcaEMcpZlJlM1TI6Y",
            authDomain: "fluxgram-87009.firebaseapp.com",
            projectId: "fluxgram-87009",
            storageBucket: "fluxgram-87009.firebasestorage.app",
            messagingSenderId: "698836385253",
            appId: "1:698836385253:web:c40e67ee9006cff536830c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- GLOBAL STATE ---
        let user = { uid: "user_" + Math.random().toString(36).substr(2, 9), name: "User" };
        let activeChatId = "ceo_kawchur";
        const CEO = { name: "KAWCHUR (CEO)", phone: "+8801902397621", username: "@kawchur", avatar: "K", bg: "#ff0050" };

        // --- AUTH & NAVIGATION ---
        window.executeLogin = () => {
            const name = document.getElementById('authName').value || "User";
            user.name = name;
            document.getElementById('setProfileName').innerText = name;
            document.getElementById('auth-screen').style.opacity = '0';
            setTimeout(() => { document.getElementById('auth-screen').style.display = 'none'; initApp(); }, 500);
        };

        window.navTo = (id) => document.getElementById(id).classList.add('active');
        window.navBack = () => document.querySelectorAll('.view-layer').forEach(v => v.classList.remove('active'));

        function initApp() {
            const list = document.getElementById('chatList');
            list.innerHTML = `
                <div class="chat-cell active" onclick="openChat('ceo_kawchur')">
                    <div class="c-avatar" style="background:var(--primary)">K</div>
                    <div style="flex:1">
                        <div style="font-weight:600">${CEO.name} <i class="fas fa-check-circle verified"></i></div>
                        <div style="font-size:0.9rem; color:var(--text-muted)">CEO is online</div>
                    </div>
                </div>
            `;
            openChat('ceo_kawchur');
        }

        window.openChat = (id) => {
            document.getElementById('activeChat').style.display = 'flex';
            document.getElementById('activeName').innerHTML = `${CEO.name} <i class="fas fa-check-circle verified"></i>`;
            document.getElementById('activeAvatar').innerText = "K";
            document.getElementById('activeAvatar').style.background = CEO.bg;
            if(window.innerWidth <= 768) document.getElementById('chatArea').classList.add('active');
            loadMessages(id);
        };

        // --- CORE MESSAGING (FIREBASE) ---
        function loadMessages(chatId) {
            const scroll = document.getElementById('msgScroll');
            const q = query(collection(db, "chats", chatId, "messages"), orderBy("timestamp", "asc"));
            onSnapshot(q, (snapshot) => {
                scroll.innerHTML = '';
                snapshot.forEach(doc => {
                    const d = doc.data();
                    const isMe = d.senderId === user.uid;
                    scroll.innerHTML += `
                        <div class="bubble-wrap ${isMe ? 'wrap-tx' : 'wrap-rx'}">
                            <div class="bubble ${isMe ? 'bubble-tx' : 'bubble-rx'}">${d.text}</div>
                        </div>
                    `;
                });
                scroll.scrollTop = scroll.scrollHeight;
            });
        }

        window.sendMessage = async () => {
            const input = document.getElementById('msgInput');
            if(!input.value.trim()) return;
            await addDoc(collection(db, "chats", activeChatId, "messages"), {
                text: input.value, senderId: user.uid, timestamp: serverTimestamp()
            });
            input.value = '';
        };

        // --- CALL SYSTEM ---
        window.startCall = () => {
            document.getElementById('call-view').style.display = 'flex';
        };
        window.endCall = () => {
            document.getElementById('call-view').style.display = 'none';
        };

        window.backToList = (e) => {
            e.stopPropagation();
            document.getElementById('chatArea').classList.remove('active');
        };
        
        window.toggleDrawer = () => navTo('view-settings');
    </script>
</body>
</html>
