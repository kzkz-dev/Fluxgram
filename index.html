<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fluxgram | Global Secure Messenger</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Outfit:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-base: #0e1621; 
            --bg-surface: #17212b;
            --bg-hover: #202b36;
            --primary: #ff0050; 
            --accent: #00f3ff;
            --text-main: #ffffff;
            --text-muted: #7f91a4;
            --divider: #101921;
            --msg-rx: #182533;
            --msg-tx: #ff0050;
            --transition: 0.3s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* --- RESET & LAYOUT --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { width: 100vw; height: 100dvh; background: var(--bg-base); color: var(--text-main); font-family: 'Roboto', sans-serif; overflow: hidden; position: fixed; inset: 0; }
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 4px; }

        /* --- SPA VIEW ENGINE --- */
        #app-root { display: flex; width: 100%; height: 100%; position: relative; overflow: hidden; }
        .view-layer { position: absolute; inset: 0; background: var(--bg-base); z-index: 50; transform: translateX(100%); transition: transform var(--transition); display: flex; flex-direction: column; }
        .view-layer.active { transform: translateX(0); }
        .base-layer { position: relative; z-index: 10; transform: translateX(0); width: 100%; height: 100%; display: flex; }

        /* --- REUSABLE COMPONENTS --- */
        .app-header { height: 56px; background: var(--bg-surface); display: flex; align-items: center; padding: 0 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); z-index: 100; flex-shrink: 0; }
        .btn-icon { background: none; border: none; color: var(--text-muted); font-size: 1.3rem; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .btn-icon:hover { background: var(--bg-hover); color: var(--text-main); }
        .header-title { font-size: 1.25rem; font-weight: 500; margin-left: 10px; flex: 1; font-family: 'Outfit', sans-serif; }
        
        .list-item { display: flex; align-items: center; padding: 12px 20px; cursor: pointer; transition: 0.2s; background: var(--bg-surface); }
        .list-item:hover { background: var(--bg-hover); }
        .list-icon { width: 40px; font-size: 1.4rem; color: var(--text-muted); display: flex; align-items: center; justify-content: center; }
        .list-text { flex: 1; font-size: 1rem; border-bottom: 1px solid var(--divider); padding: 12px 0; display: flex; flex-direction: column; justify-content: center;}
        .list-item:last-child .list-text { border-bottom: none; }
        .list-sub { font-size: 0.85rem; color: var(--text-muted); margin-top: 2px; }
        
        .verified-badge { color: #00f3ff; font-size: 0.85rem; margin-left: 5px; }
        .mention { color: var(--accent); cursor: pointer; text-decoration: none; font-weight: 500; }
        .mention:hover { text-decoration: underline; }

        /* --- 0. AUTH SCREEN --- */
        #auth-screen { position: absolute; inset: 0; background: var(--bg-base); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; transition: 0.5s; }
        .auth-logo { font-size: 3.5rem; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; font-family: 'Outfit'; }
        .auth-logo i { color: var(--primary); }
        .auth-logo span { font-weight: 900; }
        .auth-card { background: var(--bg-surface); padding: 30px; border-radius: 16px; width: 100%; max-width: 380px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-top: 20px; }
        .auth-title { text-align: center; font-size: 1.5rem; margin-bottom: 25px; font-weight: 500; }
        
        .phone-input-group { display: flex; background: var(--bg-base); border-radius: 12px; border: 1px solid var(--divider); overflow: hidden; margin-bottom: 20px; }
        .country-select { background: transparent; border: none; color: white; padding: 15px; outline: none; border-right: 1px solid var(--divider); cursor: pointer; font-size: 1rem; }
        .phone-input { flex: 1; background: transparent; border: none; color: white; padding: 15px; outline: none; font-size: 1rem; }
        .phone-input-group:focus-within { border-color: var(--accent); }
        
        .auth-btn { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 12px; color: white; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .auth-btn:active { transform: scale(0.97); }

        /* --- 1. SIDEBAR (CHAT LIST) --- */
        .sidebar { width: 350px; height: 100%; background: var(--bg-surface); border-right: 1px solid var(--divider); display: flex; flex-direction: column; flex-shrink: 0; z-index: 20; transition: var(--transition); }
        .search-container { padding: 10px 15px; display: flex; gap: 10px; align-items: center; }
        .search-box { flex: 1; background: var(--bg-base); border-radius: 20px; display: flex; align-items: center; padding: 0 15px; height: 40px; border: 1px solid transparent; }
        .search-box:focus-within { border-color: var(--accent); }
        .search-box input { background: transparent; border: none; color: white; width: 100%; height: 100%; outline: none; margin-left: 10px; font-size: 0.95rem; }
        
        .chat-list { flex: 1; overflow-y: auto; background: var(--bg-base); }
        .chat-cell { display: flex; align-items: center; padding: 10px 15px; cursor: pointer; transition: 0.2s; }
        .chat-cell:hover { background: var(--bg-hover); }
        .chat-cell.active { background: #2b5278; } 
        .c-avatar { width: 54px; height: 54px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: bold; margin-right: 15px; position: relative; flex-shrink: 0; font-family: 'Outfit', sans-serif;}
        .c-info { flex: 1; overflow: hidden; border-bottom: 1px solid var(--divider); padding-bottom: 10px; }
        .chat-cell:last-child .c-info { border-bottom: none; }
        .c-top { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 3px; }
        .c-name { font-weight: 600; font-size: 1.05rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #fff; }
        .c-time { font-size: 0.75rem; color: var(--text-muted); }
        .c-bottom { display: flex; justify-content: space-between; align-items: center; }
        .c-msg { font-size: 0.95rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 10px; }
        .badge { background: var(--text-muted); color: white; font-size: 0.75rem; font-weight: bold; padding: 2px 7px; border-radius: 10px; }
        .badge.unread { background: var(--accent); color: var(--bg-base); }

        .fab-main { position: absolute; bottom: 25px; right: 25px; width: 56px; height: 56px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--bg-base); cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 30; transition: 0.2s; }
        .fab-main:active { transform: scale(0.9); }

        /* --- 2. MAIN CHAT AREA --- */
        .chat-area { flex: 1; display: flex; flex-direction: column; background: url('https://www.transparenttextures.com/patterns/stardust.png'), var(--bg-base); position: relative; height: 100%; }
        
        .chat-top-bar { height: 60px; background: var(--bg-surface); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; border-bottom: 1px solid var(--divider); z-index: 10; cursor: pointer; }
        .chat-top-bar:hover { background: var(--bg-hover); }
        .ct-left { display: flex; align-items: center; gap: 15px; flex: 1; overflow: hidden; }
        .back-nav { display: none; color: var(--text-muted); font-size: 1.4rem; padding: 5px; }
        .ct-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-family: 'Outfit'; }
        .ct-info { flex: 1; overflow: hidden; }
        .ct-name { font-weight: 600; font-size: 1.1rem; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
        .ct-status { font-size: 0.85rem; color: var(--text-muted); }
        .ct-status.online { color: var(--accent); }
        .ct-actions { display: flex; align-items: center; gap: 5px; }

        /* Messages */
        .msg-scroll { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
        .date-badge { align-self: center; background: rgba(0,0,0,0.3); padding: 5px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 500; color: white; margin: 10px 0; }
        .bubble-wrap { display: flex; flex-direction: column; max-width: 75%; position: relative; }
        .wrap-rx { align-self: flex-start; }
        .wrap-tx { align-self: flex-end; }
        .bubble { padding: 8px 12px; border-radius: 12px; font-size: 1rem; line-height: 1.4; position: relative; word-wrap: break-word; min-width: 80px; }
        .bubble-rx { background: var(--msg-rx); border-bottom-left-radius: 4px; }
        .bubble-tx { background: var(--msg-tx); border-bottom-right-radius: 4px; }
        .b-time { font-size: 0.7rem; color: rgba(255,255,255,0.6); float: right; margin-top: 5px; margin-left: 10px; position: relative; top: 2px; }
        .b-tick { color: var(--accent); margin-left: 3px; font-size: 0.75rem; }
        
        /* Reaction UI */
        .reactions { display: flex; gap: 5px; position: absolute; bottom: -12px; right: 5px; z-index: 5; }
        .wrap-rx .reactions { right: auto; left: 5px; }
        .reaction-bubble { background: var(--bg-surface); border: 1px solid var(--divider); border-radius: 15px; padding: 2px 6px; font-size: 0.8rem; box-shadow: 0 2px 5px rgba(0,0,0,0.5); cursor: pointer; }

        /* Input Bar */
        .input-bar { background: var(--bg-surface); padding: 10px 15px; display: flex; align-items: flex-end; gap: 10px; z-index: 20; border-top: 1px solid var(--divider); }
        .attach-menu-btn { color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 10px; transition: 0.2s; }
        .attach-menu-btn:hover { color: var(--accent); }
        .input-field { flex: 1; background: var(--bg-base); border-radius: 20px; padding: 10px 15px; display: flex; align-items: flex-end; }
        .input-field textarea { width: 100%; background: transparent; border: none; color: white; font-family: inherit; font-size: 1rem; outline: none; resize: none; max-height: 150px; line-height: 1.4; }
        .mic-btn { width: 45px; height: 45px; border-radius: 50%; background: var(--bg-base); display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: var(--text-muted); cursor: pointer; transition: 0.2s; flex-shrink: 0; }
        .mic-btn.send-mode { background: var(--primary); color: white; }

        /* Emoticons & Attachment Shells */
        .emoji-picker { position: absolute; bottom: 70px; left: 15px; background: var(--bg-surface); border: 1px solid var(--divider); border-radius: 12px; width: 300px; height: 200px; z-index: 30; display: none; padding: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); overflow-y: auto; }
        .emoji-list { display: flex; flex-wrap: wrap; gap: 10px; font-size: 1.5rem; cursor: pointer; }
        
        .attach-sheet { position: absolute; bottom: 70px; left: 15px; right: 15px; background: var(--bg-surface); border: 1px solid var(--divider); border-radius: 12px; padding: 20px; z-index: 30; display: none; grid-template-columns: repeat(4, 1fr); gap: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .a-item { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; }
        .a-icon { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; color: white; transition: transform 0.2s; }
        .a-text { font-size: 0.8rem; color: var(--text-muted); }

        /* --- 3. DRAWER (MAIN MENU) --- */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); z-index: 400; display: none; }
        .drawer-menu { position: absolute; top: 0; left: -300px; width: 280px; height: 100%; background: var(--bg-surface); z-index: 401; transition: 0.3s; display: flex; flex-direction: column; border-right: 1px solid var(--divider); }
        .drawer-menu.open { left: 0; }
        .dm-header { padding: 20px; background: var(--bg-hover); display: flex; flex-direction: column; gap: 10px; }
        .dm-avatar { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; font-family: 'Outfit'; }
        .dm-name { font-weight: 600; font-size: 1.1rem; }
        .dm-phone { font-size: 0.9rem; color: var(--text-muted); }
        .dm-list { flex: 1; overflow-y: auto; padding: 10px 0; }

        /* --- 4. PROFILE & SETTINGS VIEWS --- */
        .view-layer { background: var(--bg-base); }
        .info-header { padding: 30px 20px; text-align: center; background: var(--bg-base); border-bottom: 1px solid var(--divider); }
        .info-avatar { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 15px; font-size: 4rem; display: flex; align-items: center; justify-content: center; color: white; }
        .info-name { font-size: 1.5rem; font-weight: 600; margin-bottom: 5px; }
        .info-status { color: var(--accent); font-size: 0.9rem; margin-bottom: 20px; }
        .info-actions { display: flex; justify-content: center; gap: 20px; }
        .ia-btn { display: flex; flex-direction: column; align-items: center; gap: 8px; color: var(--text-muted); cursor: pointer; }
        .ia-btn i { font-size: 1.5rem; }
        .ia-btn:hover { color: var(--primary); }
        
        .settings-block { background: var(--bg-surface); margin-bottom: 10px; border-top: 1px solid var(--divider); border-bottom: 1px solid var(--divider); }
        .section-header { padding: 15px 20px 5px; font-size: 0.9rem; color: var(--accent); font-weight: 600; }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 768px) {
            .sidebar { width: 100%; position: absolute; z-index: 20; }
            .chat-area { position: absolute; width: 100%; z-index: 30; transform: translateX(100%); transition: var(--transition); }
            .chat-area.active { transform: translateX(0); }
            .back-nav { display: block; }
            .attach-sheet { grid-template-columns: repeat(3, 1fr); }
            .emoji-picker { width: calc(100% - 30px); }
        }
    </style>
</head>
<body>

    <div id="app-root">

        <div id="auth-screen">
            <div class="auth-logo"><i class="fas fa-bolt"></i> <span>Flux<b>gram</b></span></div>
            <div class="auth-card">
                <div class="auth-title">Sign in to Fluxgram</div>
                
                <div style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 10px;">Please confirm your country code and enter your phone number.</div>
                
                <div class="phone-input-group">
                    <select class="country-select" id="countryCode">
                        <option value="+880">BD (+880)</option>
                        <option value="+1">USA (+1)</option>
                        <option value="+44">UK (+44)</option>
                        <option value="+91">IND (+91)</option>
                        <option value="+92">PAK (+92)</option>
                    </select>
                    <input type="tel" class="phone-input" id="authPhone" placeholder="1XXXXXXXXX">
                </div>

                <div class="phone-input-group" style="margin-top:-10px;">
                    <input type="text" class="phone-input" id="authName" placeholder="Your Name (e.g. John)">
                </div>
                
                <button class="auth-btn" onclick="executeLogin()">NEXT</button>
            </div>
        </div>

        <div class="base-layer">
            
            <div class="overlay" id="mainOverlay" onclick="toggleDrawer()"></div>
            <div class="drawer-menu" id="drawerMenu">
                <div class="dm-header">
                    <div class="dm-avatar" id="drAvatar">U</div>
                    <div>
                        <div class="dm-name" id="drName">User</div>
                        <div class="dm-phone" id="drPhone">+880</div>
                    </div>
                </div>
                <div class="dm-list">
                    <div class="list-item" onclick="alert('Creating channels requires Backend.')"><i class="fas fa-bullhorn list-icon"></i><div class="list-text">New Channel</div></div>
                    <div class="list-item" onclick="alert('Creating groups requires Backend.')"><i class="fas fa-users list-icon"></i><div class="list-text">New Group</div></div>
                    <div class="list-item" onclick="alert('Fetching Contacts from Database...')"><i class="fas fa-user-friends list-icon"></i><div class="list-text">Contacts</div></div>
                    <div class="list-item" onclick="alert('WebRTC Signaling Server needed for Calls.')"><i class="fas fa-phone-alt list-icon"></i><div class="list-text">Calls</div></div>
                    <div class="list-item" onclick="openView('view-settings')"><i class="fas fa-cog list-icon"></i><div class="list-text">Settings</div></div>
                </div>
            </div>

            <div class="sidebar" id="sidebar">
                <div class="search-container">
                    <button class="btn-icon" onclick="toggleDrawer()"><i class="fas fa-bars"></i></button>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search">
                    </div>
                </div>
                <div class="chat-list" id="chatList">
                    </div>
                <div class="fab-main"><i class="fas fa-pen"></i></div>
            </div>

            <div class="chat-area" id="chatArea">
                <div id="emptyChat" style="height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; color:var(--text-muted);">
                    <div style="background:rgba(0,0,0,0.3); padding:15px 30px; border-radius:20px; font-size:0.9rem;">Select a chat to start messaging</div>
                </div>

                <div id="activeChat" style="display:none; height:100%; flex-direction:column;">
                    
                    <div class="chat-top-bar" onclick="openProfileView()">
                        <div class="ct-left">
                            <i class="fas fa-arrow-left back-nav" onclick="closeChat(event)"></i>
                            <div class="ct-avatar" id="activeAvatar"></div>
                            <div class="ct-info">
                                <div class="ct-name" id="activeName">Name</div>
                                <div class="ct-status" id="activeStatus">online</div>
                            </div>
                        </div>
                        <div class="ct-actions" onclick="event.stopPropagation()">
                            <button class="btn-icon" onclick="alert('Initiating Audio Call... (Requires WebRTC)')"><i class="fas fa-phone-alt"></i></button>
                            <button class="btn-icon" onclick="alert('Initiating Video Call... (Requires WebRTC)')"><i class="fas fa-video"></i></button>
                            <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                        </div>
                    </div>

                    <div class="msg-scroll" id="msgScroll">
                        </div>

                    <div class="emoji-picker" id="emojiPicker">
                        <div class="emoji-list">
                            <span>üòÄ</span><span>üòÇ</span><span>üòç</span><span>ü•∞</span><span>üòé</span><span>üò≠</span><span>üò°</span><span>üëç</span><span>‚ù§Ô∏è</span><span>üî•</span><span>üéâ</span><span>üíØ</span>
                        </div>
                        <div style="text-align:center; font-size:0.8rem; color:var(--text-muted); margin-top:10px;">Stickers require Firebase Storage</div>
                    </div>

                    <div class="attach-sheet" id="attachSheet">
                        <div class="a-item" onclick="alert('Requires Storage permission & Backend')"><div class="a-icon" style="background:#f44336;"><i class="fas fa-image"></i></div><span class="a-text">Gallery</span></div>
                        <div class="a-item" onclick="alert('Requires Storage Backend')"><div class="a-icon" style="background:#2196f3;"><i class="fas fa-file-alt"></i></div><span class="a-text">File</span></div>
                        <div class="a-item"><div class="a-icon" style="background:#4caf50;"><i class="fas fa-map-marker-alt"></i></div><span class="a-text">Location</span></div>
                        <div class="a-item"><div class="a-icon" style="background:#00bcd4;"><i class="fas fa-user"></i></div><span class="a-text">Contact</span></div>
                    </div>

                    <div class="input-bar">
                        <i class="far fa-smile attach-menu-btn" onclick="toggleUI('emojiPicker')"></i>
                        <i class="fas fa-paperclip attach-menu-btn" onclick="toggleUI('attachSheet')"></i>
                        <div class="input-field">
                            <textarea id="msgInput" rows="1" placeholder="Message"></textarea>
                        </div>
                        <button class="mic-btn" id="sendBtn" onclick="handleSend()">
                            <i class="fas fa-microphone" id="sendIcon"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="view-layer" id="view-chat-info">
            <div class="app-header" style="background: var(--bg-base); box-shadow:none; border:none;">
                <i class="fas fa-arrow-left btn-icon" onclick="closeView('view-chat-info')"></i>
                <div class="header-title"></div>
            </div>
            <div class="info-header">
                <div class="info-avatar" id="pAvatar">K</div>
                <div class="info-name" id="pName">KAWCHUR <i class="fas fa-check-circle verified-badge"></i></div>
                <div class="info-status" id="pStatus">CEO of Fluxgram</div>
                
                <div class="info-actions">
                    <div class="ia-btn" onclick="alert('Calling...')"><i class="fas fa-phone-alt"></i> Call</div>
                    <div class="ia-btn" onclick="alert('Video Calling...')"><i class="fas fa-video"></i> Video</div>
                    <div class="ia-btn"><i class="fas fa-bell-slash"></i> Mute</div>
                </div>
            </div>
            <div class="settings-block" style="margin-top:0;">
                <div class="list-item"><i class="fas fa-info-circle list-icon"></i><div class="list-text" id="pPhone">+8801902397621<div class="list-sub">Mobile</div></div></div>
                <div class="list-item"><i class="fas fa-at list-icon"></i><div class="list-text" id="pUser">@kawchur<div class="list-sub">Username</div></div></div>
                <div class="list-item"><i class="fas fa-pen list-icon"></i><div class="list-text">Building the future with Flux AI.<div class="list-sub">Bio</div></div></div>
            </div>
        </div>

        <div class="view-layer" id="view-settings">
            <div class="app-header">
                <i class="fas fa-arrow-left btn-icon" onclick="closeView('view-settings')"></i>
                <div class="header-title">Settings</div>
                <i class="fas fa-ellipsis-v btn-icon"></i>
            </div>
            <div style="flex:1; overflow-y:auto; padding-bottom: 20px;">
                <div style="padding: 20px; background: var(--bg-surface); display:flex; align-items:center; gap:20px; border-bottom: 1px solid var(--divider);">
                    <div id="setAvatar" style="width:70px; height:70px; border-radius:50%; background:var(--primary); font-size:2rem; display:flex; align-items:center; justify-content:center; font-family:'Outfit';">U</div>
                    <div>
                        <div style="font-size:1.3rem; font-weight:600;" id="setName">User</div>
                        <div style="color:var(--text-muted); font-size:0.9rem; margin-top:3px;">online</div>
                    </div>
                </div>

                <div class="settings-block">
                    <div class="list-item"><div class="list-text" id="setPhone">+880<div class="list-sub">Tap to change phone number</div></div></div>
                    <div class="list-item" onclick="promptEditUsername()"><div class="list-text" id="setUser">@username<div class="list-sub">Edit Username</div></div></div>
                </div>

                <div class="section-header">Privacy & Security</div>
                <div class="settings-block">
                    <div class="list-item" onclick="alert('Privacy Updated: Number is now hidden.')"><i class="fas fa-eye-slash list-icon"></i><div class="list-text">Hide Phone Number<div class="list-sub">Nobody can see your number</div></div></div>
                    <div class="list-item"><i class="fas fa-lock list-icon"></i><div class="list-text">Passcode Lock</div></div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- DATA LAYER (CEO Data included) ---
        let chatData = [
            { id: 1, type: 'personal', name: "KAWCHUR", username: "@kawchur", phone: "+8801902397621", verified: true, avatar: "K", bg: "linear-gradient(135deg, #ff0050, #ff5e62)", msg: "Welcome to Fluxgram! I am the CEO.", bio: "Building the future with Flux AI.", time: "Just now", unread: 1 },
            { id: 2, type: 'channel', name: "Fluxgram Updates", username: "@fluxgram", verified: true, avatar: '<i class="fas fa-bullhorn"></i>', bg: "#0066ff", msg: "Version 4.0 released globally! üåç", bio: "Official announcement channel.", time: "10:00 AM", unread: 3 },
            { id: 3, type: 'personal', name: "Sadia", username: "@sadia_22", phone: "+8801700000000", verified: false, avatar: "S", bg: "#e91e63", msg: "Hey, are you checking out the new @kawchur profile?", bio: "Busy.", time: "Yesterday", unread: 0 }
        ];

        let currentUser = {};
        let currentChatId = null;

        // --- TIME FORMATTER ---
        function getCurrentTime() {
            return new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
        }

        // --- AUTH LOGIC ---
        function executeLogin() {
            const code = document.getElementById('countryCode').value;
            const phone = document.getElementById('authPhone').value.trim();
            const name = document.getElementById('authName').value.trim() || "User";

            if (!phone) {
                alert("Please enter a valid phone number.");
                return;
            }

            currentUser = {
                name: name,
                phone: code + phone,
                username: "@" + name.toLowerCase().replace(/\s/g, ''),
                avatar: name.charAt(0).toUpperCase()
            };

            // Update UI Elements
            document.getElementById('drName').innerText = currentUser.name;
            document.getElementById('drPhone').innerText = currentUser.phone;
            document.getElementById('drAvatar').innerText = currentUser.avatar;

            document.getElementById('setName').innerText = currentUser.name;
            document.getElementById('setPhone').innerText = currentUser.phone;
            document.getElementById('setUser').innerText = currentUser.username;
            document.getElementById('setAvatar').innerText = currentUser.avatar;

            // Hide Auth
            document.getElementById('auth-screen').style.opacity = '0';
            document.getElementById('auth-screen').style.pointerEvents = 'none';
            
            initChatList();
        }

        // --- UI ROUTING & DRAWER ---
        function openView(id) { document.getElementById(id).classList.add('active'); toggleDrawer(true); }
        function closeView(id) { document.getElementById(id).classList.remove('active'); }
        function toggleDrawer(forceClose = false) {
            const menu = document.getElementById('drawerMenu');
            const overlay = document.getElementById('mainOverlay');
            if(forceClose || menu.classList.contains('open')) {
                menu.classList.remove('open');
                overlay.style.display = 'none';
            } else {
                menu.classList.add('open');
                overlay.style.display = 'block';
            }
        }
        function toggleUI(id) {
            const el = document.getElementById(id);
            el.style.display = el.style.display === 'flex' || el.style.display === 'grid' ? 'none' : (id==='attachSheet' ? 'grid' : 'flex');
        }

        // --- USERNAME LOGIC ---
        function promptEditUsername() {
            const newName = prompt("Enter new username (without @):", currentUser.username.substring(1));
            if(newName) {
                currentUser.username = "@" + newName.replace(/\s/g, '').toLowerCase();
                document.getElementById('setUser').innerText = currentUser.username;
                alert("Username updated to " + currentUser.username);
            }
        }

        function formatMessageText(text) {
            // Converts @username to clickable tags
            return text.replace(/(@\w+)/g, '<span class="mention" onclick="openProfileByUsername(\'$1\'); event.stopPropagation();">$1</span>');
        }

        function openProfileByUsername(username) {
            const chat = chatData.find(c => c.username === username);
            if(chat) {
                openProfileView(chat);
            } else {
                alert("User " + username + " not found in database.");
            }
        }

        // --- CHAT LOGIC ---
        function initChatList() {
            const list = document.getElementById('chatList');
            list.innerHTML = '';
            chatData.forEach(chat => {
                const unreadHTML = chat.unread > 0 ? `<div class="badge unread">${chat.unread}</div>` : `<i class="fas fa-check-double" style="color:var(--accent); font-size:0.8rem;"></i>`;
                list.innerHTML += `
                    <div class="chat-cell" onclick="openChat(${chat.id})">
                        <div class="c-avatar" style="background:${chat.bg}">${chat.avatar}</div>
                        <div class="c-info">
                            <div class="c-top">
                                <div class="c-name">${chat.name} ${chat.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}</div>
                                <div class="c-time">${chat.time}</div>
                            </div>
                            <div class="c-bottom">
                                <div class="c-msg">${formatMessageText(chat.msg)}</div>
                                ${unreadHTML}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function openChat(id) {
            currentChatId = id;
            const chat = chatData.find(c => c.id === id);
            
            document.getElementById('activeName').innerHTML = `${chat.name} ${chat.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}`;
            document.getElementById('activeAvatar').innerHTML = chat.avatar;
            document.getElementById('activeAvatar').style.background = chat.bg;
            document.getElementById('activeStatus').innerText = chat.type === 'personal' ? 'Online' : 'Subscribers';
            
            // Set Profile Data
            openProfileView(chat, false); // pre-load data into profile view

            document.getElementById('emptyChat').style.display = 'none';
            document.getElementById('activeChat').style.display = 'flex';
            if(window.innerWidth <= 768) document.getElementById('chatArea').classList.add('active');

            // Load Messages
            const scroll = document.getElementById('msgScroll');
            scroll.innerHTML = `
                <div class="date-badge">Today</div>
                <div class="bubble-wrap wrap-rx">
                    <div class="bubble bubble-rx">
                        ${formatMessageText(chat.msg)}
                        <div class="b-time">${chat.time}</div>
                    </div>
                    <div class="reactions"><div class="reaction-bubble" onclick="alert('Reaction recorded!')">‚ù§Ô∏è 1</div></div>
                </div>
            `;
        }

        function closeChat(e) {
            if(e) e.stopPropagation();
            document.getElementById('chatArea').classList.remove('active');
            currentChatId = null;
        }

        function openProfileView(chatObj = null, show = true) {
            if(!chatObj) chatObj = chatData.find(c => c.id === currentChatId);
            if(!chatObj) return;

            document.getElementById('pName').innerHTML = `${chatObj.name} ${chatObj.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}`;
            document.getElementById('pAvatar').innerHTML = chatObj.avatar;
            document.getElementById('pAvatar').style.background = chatObj.bg;
            document.getElementById('pStatus').innerText = chatObj.bio || "No bio available";
            document.getElementById('pUser').innerHTML = `${chatObj.username}<div class="list-sub">Username</div>`;
            document.getElementById('pPhone').innerHTML = `${chatObj.phone || 'Hidden'}<div class="list-sub">Mobile</div>`;

            if(show) openView('view-chat-info');
        }

        // --- SENDING LOGIC ---
        const input = document.getElementById('msgInput');
        const sendBtn = document.getElementById('sendBtn');
        const sendIcon = document.getElementById('sendIcon');

        input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
            if(this.value.trim().length > 0) {
                sendBtn.classList.add('send-mode');
                sendIcon.className = 'fas fa-paper-plane';
            } else {
                sendBtn.classList.remove('send-mode');
                sendIcon.className = 'fas fa-microphone';
                this.style.height = 'auto';
            }
        });

        input.addEventListener('keypress', function(e) {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
        });

        function handleSend() {
            const text = input.value.trim();
            if(!text) {
                alert('Voice recording requires WebRTC MediaDevices API connection.');
                return;
            }

            const timeStr = getCurrentTime();
            const scroll = document.getElementById('msgScroll');
            
            scroll.innerHTML += `
                <div class="bubble-wrap wrap-tx">
                    <div class="bubble bubble-tx" ondblclick="alert('Liked!')">
                        ${formatMessageText(text).replace(/\n/g, '<br>')}
                        <div class="b-time">${timeStr} <i class="fas fa-check b-tick"></i></div>
                    </div>
                </div>
            `;
            
            input.value = '';
            input.style.height = 'auto';
            sendBtn.classList.remove('send-mode');
            sendIcon.className = 'fas fa-microphone';
            scroll.scrollTop = scroll.scrollHeight;

            // Fake Read Receipt
            setTimeout(() => {
                const ticks = scroll.querySelectorAll('.b-tick');
                if(ticks.length > 0) ticks[ticks.length-1].className = 'fas fa-check-double b-tick';
            }, 1000);
        }

        // Close Popovers on Outside Click
        document.addEventListener('click', (e) => {
            if(!e.target.closest('.input-bar')) {
                document.getElementById('attachSheet').style.display = 'none';
                document.getElementById('emojiPicker').style.display = 'none';
            }
        });

    </script>
</body>
</html>
