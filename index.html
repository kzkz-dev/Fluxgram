<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fluxgram | Fast, Secure, Powerful</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --tg-theme-bg: #0e1621;
            --tg-theme-secondary-bg: #17212b;
            --tg-theme-text: #ffffff;
            --tg-theme-hint: #7f91a4;
            --tg-theme-link: #6ab2f2;
            --tg-theme-button: #5288c1;
            --tg-msg-out: #2b5278;
            --tg-msg-in: #182533;
            --accent: #2481cc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Roboto', sans-serif; }
        body { background: var(--tg-theme-bg); color: var(--tg-theme-text); height: 100dvh; overflow: hidden; }

        /* --- AUTH SCREEN --- */
        #auth-screen {
            position: fixed; inset: 0; z-index: 9999; background: var(--tg-theme-bg);
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }
        .auth-logo { font-size: 80px; color: var(--accent); margin-bottom: 20px; }
        .auth-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .auth-desc { color: var(--tg-theme-hint); margin-bottom: 30px; padding: 0 40px; }
        .google-btn {
            background: white; color: #000; padding: 12px 24px; border-radius: 8px;
            display: flex; align-items: center; gap: 10px; font-weight: 500; cursor: pointer; border: none;
        }

        /* --- LAYOUT --- */
        #app-root { display: flex; height: 100%; width: 100%; }
        
        /* Sidebar */
        .sidebar { width: 30%; border-right: 1px solid #101921; background: var(--tg-theme-secondary-bg); display: flex; flex-direction: column; }
        .sb-header { padding: 15px; display: flex; align-items: center; gap: 15px; }
        .search-bar { flex: 1; background: #242f3d; border-radius: 20px; padding: 8px 15px; display: flex; align-items: center; }
        .search-bar input { background: transparent; border: none; color: white; margin-left: 10px; outline: none; width: 100%; }

        /* Chat List */
        .chat-list { flex: 1; overflow-y: auto; }
        .chat-item { padding: 12px 15px; display: flex; align-items: center; gap: 12px; cursor: pointer; border-bottom: 1px solid #101921; }
        .chat-item:hover { background: #202b36; }
        .chat-item.active { background: var(--tg-theme-button); }
        .avatar { width: 50px; height: 50px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }

        /* Main Chat Area */
        .main-chat { flex: 1; display: flex; flex-direction: column; background: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-blend-mode: overlay; background-color: #0e1621; }
        .chat-header { height: 60px; background: var(--tg-theme-secondary-bg); display: flex; align-items: center; padding: 0 20px; justify-content: space-between; border-bottom: 1px solid #101921; }
        
        .messages-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 8px; }
        .msg-bubble { max-width: 70%; padding: 8px 15px; border-radius: 12px; font-size: 0.95rem; position: relative; line-height: 1.4; }
        .msg-in { align-self: flex-start; background: var(--tg-msg-in); border-bottom-left-radius: 2px; }
        .msg-out { align-self: flex-end; background: var(--tg-msg-out); border-bottom-right-radius: 2px; }

        /* Input Area */
        .input-area { background: var(--tg-theme-secondary-bg); padding: 10px 20px; display: flex; align-items: center; gap: 15px; }
        .msg-input { flex: 1; background: transparent; border: none; color: white; outline: none; font-size: 1rem; }

        /* Call Overlay */
        #call-screen { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: space-evenly; }
        .call-user-img { width: 120px; height: 120px; border-radius: 50%; border: 3px solid var(--accent); }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { width: 100%; }
            .main-chat { position: fixed; inset: 0; transform: translateX(100%); transition: 0.3s; z-index: 100; }
            .main-chat.active { transform: translateX(0); }
        }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-logo"><i class="fas fa-paper-plane"></i></div>
        <h1 class="auth-title">Fluxgram</h1>
        <p class="auth-desc">The world's fastest messaging app. <br>Secure and Free.</p>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20">
            Sign in with Gmail
        </button>
    </div>

    <div id="app-root">
        <div class="sidebar">
            <div class="sb-header">
                <i class="fas fa-bars" style="font-size: 1.2rem; cursor: pointer;"></i>
                <div class="search-bar">
                    <i class="fas fa-search" style="color: var(--tg-theme-hint);"></i>
                    <input type="text" placeholder="Search">
                </div>
            </div>
            <div class="chat-list">
                <div class="chat-item active" onclick="openChat('ceo_kawchur')">
                    <div class="avatar" style="background: #e67e22;">K</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 500; display: flex; align-items: center; gap: 5px;">
                            KAWCHUR <i class="fas fa-check-circle" style="color: #5288c1; font-size: 0.8rem;"></i>
                        </div>
                        <div style="color: var(--tg-theme-hint); font-size: 0.85rem;">CEO is online</div>
                    </div>
                    <div style="color: var(--tg-theme-hint); font-size: 0.75rem;">12:45 PM</div>
                </div>
            </div>
        </div>

        <div class="main-chat" id="mainChat">
            <div class="chat-header">
                <div style="display: flex; align-items: center; gap: 15px;">
                    <i class="fas fa-arrow-left" onclick="closeChat()" style="cursor: pointer; display: none;" id="backBtn"></i>
                    <div class="avatar" style="width: 40px; height: 40px; font-size: 1rem; background: #e67e22;">K</div>
                    <div>
                        <div style="font-weight: 500;">KAWCHUR</div>
                        <div style="color: var(--tg-theme-link); font-size: 0.8rem;">online</div>
                    </div>
                </div>
                <div style="display: flex; gap: 20px; color: var(--tg-theme-hint);">
                    <i class="fas fa-phone-alt" style="cursor: pointer;" onclick="toggleCall(true)"></i>
                    <i class="fas fa-search"></i>
                    <i class="fas fa-ellipsis-v"></i>
                </div>
            </div>

            <div class="messages-container" id="messages">
                </div>

            <div class="input-area">
                <i class="far fa-smile" style="font-size: 1.5rem; color: var(--tg-theme-hint);"></i>
                <input type="text" class="msg-input" id="msgInput" placeholder="Message">
                <i class="fas fa-paperclip" style="font-size: 1.3rem; color: var(--tg-theme-hint);"></i>
                <i class="fas fa-paper-plane" id="sendBtn" style="color: var(--accent); font-size: 1.3rem; cursor: pointer;"></i>
            </div>
        </div>
    </div>

    <div id="call-screen">
        <div style="text-align: center;">
            <div class="avatar call-user-img" style="margin: 0 auto 20px; background: #e67e22; font-size: 3rem;">K</div>
            <h2>KAWCHUR</h2>
            <p style="color: var(--accent); margin-top: 10px;">Fluxgram Encryption...</p>
        </div>
        <div style="display: flex; gap: 50px;">
            <div onclick="toggleCall(false)" style="background: #ff3b30; width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                <i class="fas fa-phone-slash" style="font-size: 1.5rem;"></i>
            </div>
            <div style="background: #4cd964; width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-microphone" style="font-size: 1.5rem;"></i>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCsbZ1fqDivv8OyUiTcaEMcpZlJlM1TI6Y",
            authDomain: "fluxgram-87009.firebaseapp.com",
            projectId: "fluxgram-87009",
            storageBucket: "fluxgram-87009.firebasestorage.app",
            messagingSenderId: "698836385253",
            appId: "1:698836385253:web:c40e67ee9006cff536830c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let activeChat = 'ceo_kawchur';

        // --- AUTHENTICATION ---
        window.loginWithGoogle = () => {
            signInWithPopup(auth, provider).catch(err => alert(err.message));
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-screen').style.display = 'none';
                loadMessages();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
            }
        });

        // --- MESSAGING ---
        function loadMessages() {
            const q = query(collection(db, "chats", activeChat, "messages"), orderBy("timestamp", "asc"));
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('messages');
                container.innerHTML = '';
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const isMe = data.senderId === currentUser.uid;
                    container.innerHTML += `
                        <div class="msg-bubble ${isMe ? 'msg-out' : 'msg-in'}">
                            ${data.text}
                            <div style="font-size: 0.65rem; text-align: right; opacity: 0.6; margin-top: 4px;">
                                ${data.timestamp ? new Date(data.timestamp.toDate()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '...'}
                            </div>
                        </div>
                    `;
                });
                container.scrollTop = container.scrollHeight;
            });
        }

        document.getElementById('sendBtn').onclick = async () => {
            const input = document.getElementById('msgInput');
            if(!input.value.trim()) return;

            await addDoc(collection(db, "chats", activeChat, "messages"), {
                text: input.value,
                senderId: currentUser.uid,
                senderName: currentUser.displayName,
                timestamp: serverTimestamp()
            });
            input.value = '';
        };

        // --- UI HELPERS ---
        window.toggleCall = (show) => {
            document.getElementById('call-screen').style.display = show ? 'flex' : 'none';
        };

        window.openChat = () => {
            if(window.innerWidth <= 768) {
                document.getElementById('mainChat').classList.add('active');
                document.getElementById('backBtn').style.display = 'block';
            }
        };

        window.closeChat = () => {
            document.getElementById('mainChat').classList.remove('active');
        };

        // Enter to send
        document.getElementById('msgInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') document.getElementById('sendBtn').click();
        });
    </script>
</body>
</html>
