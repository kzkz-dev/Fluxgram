<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fluxgram | Chat</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div id="toast-container"></div>
    <div id="global-loader" class="loader-overlay hidden"><div class="spinner"></div></div>

    <div class="app-container">
        <div class="header">
            <button class="icon-btn" onclick="window.location.href='dashboard.html'"><i class="fas fa-arrow-left"></i></button>
            <div class="chat-header-info" onclick="Fluxgram.ui.showProfile()">
                <div class="avatar" id="chat-avatar"></div>
                <div class="chat-header-text">
                    <div class="chat-name" id="chat-name">...</div>
                    <div class="chat-status" id="chat-status">...</div>
                </div>
            </div>
            <div style="display:flex; gap: 5px;">
                <button class="icon-btn" onclick="Fluxgram.call.startCall('video')"><i class="fas fa-video"></i></button>
                <button class="icon-btn" onclick="Fluxgram.call.startCall('audio')"><i class="fas fa-phone-alt"></i></button>
            </div>
        </div>

        <div class="chat-bg">
            <div class="messages-container" id="messages-container"></div>
            <div id="typing-indicator" class="typing-indicator hidden">Typing...</div>

            <div class="input-area">
                <button class="icon-btn" onclick="document.getElementById('chat-file-input').click()"><i class="fas fa-paperclip"></i></button>
                <input type="file" id="chat-file-input" class="hidden" onchange="Fluxgram.chat.sendImage(event)">
                <div class="input-wrapper"><textarea id="msg-input" placeholder="Message..."></textarea></div>
                <button class="icon-btn hidden" id="btn-send-text" onclick="Fluxgram.chat.send()"><i class="fas fa-paper-plane"></i></button>
                <button class="icon-btn" id="btn-record-voice" onmousedown="Fluxgram.chat.startVoice()" onmouseup="Fluxgram.chat.stopVoice()"><i class="fas fa-microphone"></i></button>
            </div>
        </div>
    </div>

    <div id="call-screen" class="hidden call-overlay">
        <div style="text-align: center; margin-top: 20px;">
            <div class="call-avatar" id="callAvatarBox"></div>
            <h2 id="callName" style="font-size: 1.8rem; margin-top: 15px;">...</h2>
            <p id="callStatus" style="opacity: 0.8;">Calling...</p>
        </div>
        
        <video id="remoteVideo" class="hidden" style="position: absolute; inset: 0; width:100%; height:100%; object-fit:cover;"></video>
        <video id="localVideo" class="hidden" style="position: absolute; top:20px; right:20px; width:100px; border-radius:10px; border:2px solid var(--accent);" autoplay muted></video>

        <div class="call-controls-row">
            <div class="call-action-btn" onclick="Fluxgram.call.toggleSpeaker()">
                <div class="call-circle-btn"><i class="fas fa-volume-up"></i></div>
                <span>Speaker</span>
            </div>
            <div class="call-action-btn" onclick="Fluxgram.call.toggleVideo()">
                <div class="call-circle-btn"><i class="fas fa-video-slash"></i></div>
                <span>Video</span>
            </div>
            <div class="call-action-btn" onclick="Fluxgram.call.toggleMute()">
                <div class="call-circle-btn"><i class="fas fa-microphone"></i></div>
                <span>Mute</span>
            </div>
            <div class="call-action-btn" onclick="Fluxgram.call.endCall()">
                <div class="call-circle-btn hangup"><i class="fas fa-phone-slash"></i></div>
                <span>End Call</span>
            </div>
        </div>
    </div>

    <div id="msg-context-menu" class="hidden msg-menu">
        <div class="menu-item" onclick="Fluxgram.chat.deleteForMe()"><i class="fas fa-trash"></i> Delete for me</div>
        <div class="menu-item danger" id="btn-delete-everyone" onclick="Fluxgram.chat.deleteForEveryone()"><i class="fas fa-ban"></i> Delete for everyone</div>
    </div>

    <script type="module" src="app.js?v=9"></script>
</body>
</html>
